{% extends 'usuarios/base.html' %}
{% block content %}

<h2>Atendimento: {{ atendimento.paciente.nome }}</h2>
<p><strong>M√©dico logado:</strong> {{ request.user.get_full_name }}</p>

<hr>

{% if medicacoes_dia %}
<div class="alert alert-info">
    <strong>Medica√ß√µes j√° prescritas hoje:</strong>
    <ul>
        {% for prescricao, medico, hora in medicacoes_dia %}
            <li>{{ prescricao }} ‚Äî <em>{{ medico }}</em> √†s {{ hora|time:"H:i" }}</li>
        {% endfor %}
    </ul>
</div>
{% endif %}

<hr>

<h4>üß™ Solicitar Exame</h4>
<form method="POST">
    {% csrf_token %}
    <input type="hidden" name="acao" value="novo_exame">

    <select name="tipo_exame" class="form-select mb-2" required>
        <option value="">-- Tipo do exame --</option>
        <option value="laboratorio">Laborat√≥rio</option>
        <option value="radiologia">Radiologia</option>
    </select>

    <input type="text"
           name="nome_exame"
           placeholder="Ex: Hemograma, RX T√≥rax"
           class="form-control mb-2"
           required>

    <button type="submit" class="btn btn-primary">Solicitar</button>
</form>

<hr>

<h5>üß™ Laborat√≥rio</h5>
<ul>
    {% for exame in exames %}
        {% if exame.tipo == "laboratorio" %}
            <li>{{ exame.nome }} - <strong>{{ exame.status }}</strong></li>
        {% endif %}
    {% empty %}
        <li>Nenhum exame.</li>
    {% endfor %}
</ul>

<h5>ü©ª Radiologia</h5>
<ul>
    {% for exame in exames %}
        {% if exame.tipo == "radiologia" %}
            <li>{{ exame.nome }} - <strong>{{ exame.status }}</strong></li>
        {% endif %}
    {% empty %}
        <li>Nenhum exame.</li>
    {% endfor %}
</ul>

<hr>

<h4>üìù Salvar Atendimento</h4>
<form method="POST">
    {% csrf_token %}
    <input type="hidden" name="acao" value="salvar_atendimento">

    <div class="mb-3">
        <label>Diagn√≥stico</label>
        <textarea name="diagnostico" class="form-control">{{ atendimento.diagnostico }}</textarea>
    </div>

    <div class="mb-3">
        <label>Prescri√ß√£o</label>
        <textarea name="prescricao" class="form-control">{{ atendimento.prescricao }}</textarea>
    </div>

    <div class="mb-3">
        <label>Observa√ß√µes</label>
        <textarea name="observacoes" class="form-control">{{ atendimento.observacoes }}</textarea>
    </div>

    <div class="mb-3">
        <label>Decis√£o</label>
        <select name="decisao" class="form-select" required>
            <option value="">-- Selecione --</option>
            <option value="dispensar" {% if atendimento.decisao == "dispensar" %}selected{% endif %}>Dispensar</option>
            <option value="medicacao" {% if atendimento.decisao == "medicacao" %}selected{% endif %}>Medica√ß√£o</option>
            <option value="internacao" {% if atendimento.decisao == "internacao" %}selected{% endif %}>Interna√ß√£o</option>
        </select>
    </div>

    <button type="submit" class="btn btn-success">Salvar Atendimento</button>
</form>

{% endblock %}